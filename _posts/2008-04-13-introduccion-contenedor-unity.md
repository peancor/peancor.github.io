---
layout: page
title: Introducci√≥n al contenedor Unity
---

<p><a id="tc:e" href="http://www.codeplex.com/unity" target="_blank" title="Unity">Unity</a> es un contenedor de <a id="zv_7" href="http://es.wikipedia.org/wiki/Inyecci%C3%B3n_de_dependencias" target="_blank" title="inyecci&oacute;n de dependencias">inyecci&oacute;n de dependencias</a> que facilita el desarrollo de aplicaciones proporcionando un sistema para gestionar tanto la construcci&oacute;n de objetos como las dependencias entre los diferentes componentes de una aplicaci&oacute;n.</p> <p>Supongamos que hemos definido&nbsp; un interface a trav&eacute;s del cual gestionaremos todo el sistema de registro de eventos de nuestra aplicaci&oacute;n.</p> <div id="e_3w" style="background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; font-family: Consolas; color: black;"><div id="hzms" style="background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; font-family: Consolas; color: black;"><p id="utms" style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span id="q-va" style="color: blue;">public</span> <span id="ipcs" style="color: blue;">interface</span> <span id="lo3v" style="color: rgb(43, 145, 175);">ILoggingService</span></p> <p id="ef5d" style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</p> <p id="xpqp" style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span id="j4j1" style="color: blue;">void</span> Log(<span id="b3e-" style="color: blue;">string</span> message);</p> <p id="ph0." style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</p></div></div> <p>&nbsp;Y a su vez una clase que implementa dicho interface y que en este caso simplemente enviara el mensaje a la consola del sistema.</p> <div style="background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; font-family: Consolas; color: black;" id="q7qe"><p style="margin: 0px;" id="e2cz">&nbsp;&nbsp;&nbsp; <span style="color: blue;" id="t0ce">public</span> <span style="color: blue;" id="ekaf">class</span> <span style="color: rgb(43, 145, 175);" id="ixra">ConsoleLoggingService</span>: <span style="color: rgb(43, 145, 175);" id="cy4c">ILoggingService</span></p> <p style="margin: 0px;" id="maxh">&nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px;" id="l1je">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;" id="lo_a">public</span> <span style="color: blue;" id="eal7">void</span> Log(<span style="color: blue;" id="tiua">string</span> message)</p> <p style="margin: 0px;" id="icme">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px;" id="rh9h">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: rgb(43, 145, 175);" id="zq91">Console</span>.WriteLine(<span style="color: rgb(163, 21, 21);" id="po0y">&quot;Console: &quot;</span> + message);</p> <p style="margin: 0px;" id="ou_0">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px;" id="cdav">&nbsp;&nbsp;&nbsp; }</p></div> <p>&nbsp;El funcionamiento b&aacute;sico del contenedor es sencillo, en primer lugar registraremos en el contenedor los tipos de objetos que deseamos que gestione. Al hacerlo, adem&aacute;s, indicaremos al contenedor cual debe ser el ciclo de vida del objetos de ese tipo. En el caso que nos ocupa registraremos el interface <font color="#3d85c6" id="qnr:">ILoggingService</font> en el contenedor mapeando dicho interface al tipo <font color="#3d85c6" id="k5ow">ConsoleLoggingService</font> de tal forma que cuando solicitemos al contenedor un objeto implementando el interface <font color="#3d85c6" id="beut">ILoggingService</font> nos devuelva un objeto del tipo<font color="#3d85c6" id="dpf-"> ConsoleLoggingService</font>. Como adem&aacute;s deseamos que en la aplicaci&oacute;n solo exista una &uacute;nica instancia del sistema de eventos (<a title="Singleton" target="_blank" href="http://es.wikipedia.org/wiki/Singleton" id="ch_b">Singleton</a>), indicaremos al contenedor que se encargue de controlar la vida del objeto, de esta forma la primera vez que solicitemos el interface se crear&aacute; el objeto pero las veces sucesivas se nos devolvera una referencia al mismo objeto. El siguiente fragmento de c&oacute;digo muestra el proceso de registro utilizando uno de los m&eacute;todos que nos brinda el contenedor.</p><div id="ts.i" style="background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; font-family: Consolas; color: black;"><div id="ys2e" style="background: white none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; font-family: Consolas; color: black;"><p id="g5vz" style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span id="ecjs" style="color: rgb(43, 145, 175);">IUnityContainer</span> container = <span id="dzoo" style="color: blue;">new</span> <span id="r5rj" style="color: rgb(43, 145, 175);">UnityContainer</span>();</p> <p id="spqi" style="margin: 0px;">&nbsp;&nbsp;&nbsp; container.RegisterType&lt;<span id="w0zw" style="color: rgb(43, 145, 175);">ILoggingService</span>,</p> <p id="ph-g" style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span id="vo9o" style="color: rgb(43, 145, 175);">ConsoleLoggingService</span>&gt;(<span id="p6tj" style="color: blue;">new</span> <span id="e2:6" style="color: rgb(43, 145, 175);">ContainerControlledLifetimeManager</span>());</p></div></div><p>Veamos como funciona la inyecci&oacute;n de dependencias. El contenedor nos proporciona varias formas de realizar la inyecci&oacute;n de dependencias: a trav&eacute;s del constructor, a trav&eacute;s de una propiedad &oacute; a trav&eacute;s de un m&eacute;todo. En el caso general, las inyecci&oacute;n requiere que marquemos el constructor, la propiedad o el m&eacute;todo con un atributo que indicar&aacute; al contenedor que debe realizar la inyecci&oacute;n de un objeto. El siguiente fragmento de c&oacute;digo muestra la utilizaci&oacute;n del atributo <font color="#3d85c6" id="f.dg">InjectionConstructor</font> para indicar al contenedor que debe inyectar un objeto con el interface <font color="#3d85c6" id="i3cy">ILoggingService</font> a la hora de construir un objeto del tipo <font color="#3d85c6" id="yqcg">MainApplicationModule</font>.</p><div id="bisa" style="background: white none repeat scroll 0% 50%; font-family: Consolas; font-size: 10pt; color: black; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;"><p id="t_.6" style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span id="mhm7" style="color: blue;">public</span> <span id="c.9." style="color: blue;">class</span> <span id="cw-x" style="color: rgb(43, 145, 175);">MainApplicationModule</span></p> <p id="fjau" style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</p> <p id="oi5l" style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span id="hs03" style="color: rgb(43, 145, 175);">ILoggingService</span> mLoggingService;</p> <p id="c4wa" style="margin: 0px;">&nbsp;</p> <p id="xllo" style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; [<span id="ot.d" style="color: rgb(43, 145, 175);">InjectionConstructor</span>]</p> <p id="te4r" style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span id="es0y" style="color: blue;">public</span> MainApplicationModule(<span id="kb6b" style="color: rgb(43, 145, 175);">ILoggingService</span> loggingService)</p> <p id="jpj1" style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p> <p id="eu-9" style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; mLoggingService = loggingService;</p> <p id="p5ws" style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; mLoggingService.Log(<span id="qa4_" style="color: rgb(163, 21, 21);">&quot;Inicializado el m&oacute;dulo principal de la aplicaci&oacute;n&quot;</span>);</p> <p id="wab:" style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p> <p id="wjtu" style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</p></div><p>&nbsp;N&oacute;tese que en este caso, al existir solo un constructor, el contenedor inyectar&aacute; las dependencias en el constructor de forma aut&oacute;matica aunque no hayamos marcado el constructor, sin embargo, dicho atributo es &uacute;til para indicar que constructor utilizar en el caso de que existan varios. Si tenemos una clase con varios constructores y ninguno de ellos est&aacute; marcado con el atributo de inyecci&oacute;n, el contenedor utilizar&aacute; aquel que tenga m&aacute;s par&aacute;metros, lanzando una excepci&oacute;n en el caso de que exista m&aacute;s de un constructor que cumpla la propiedad de tener el m&aacute;ximo n&uacute;mero de par&aacute;metros.</p><div id="ohsk" style="background: white none repeat scroll 0% 50%; font-family: Consolas; font-size: 10pt; color: black; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;"><p id="zy11" style="margin: 0px;"><span id="lfp_" style="color: rgb(43, 145, 175);">&nbsp;&nbsp;&nbsp;&nbsp;1</span>&nbsp;&nbsp;&nbsp;&nbsp; <span id="uzue" style="color: blue;">static</span> <span id="omwh" style="color: blue;">void</span> Main(<span id="dd5j" style="color: blue;">string</span>[] args)</p> <p id="e2b4" style="margin: 0px;"><span id="er3." style="color: rgb(43, 145, 175);">&nbsp;&nbsp;&nbsp;&nbsp;2</span>&nbsp;&nbsp;&nbsp;&nbsp; {</p> <p id="tjx7" style="margin: 0px;"><span id="lj72" style="color: rgb(43, 145, 175);">&nbsp;&nbsp;&nbsp;&nbsp;3</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span id="shah" style="color: blue;">using</span> (<span id="jhqj" style="color: rgb(43, 145, 175);">IUnityContainer</span> container = <span id="n75m" style="color: blue;">new</span> <span id="h7s4" style="color: rgb(43, 145, 175);">UnityContainer</span>())</p> <p id="vpcx" style="margin: 0px;"><span id="w-gj" style="color: rgb(43, 145, 175);">&nbsp;&nbsp;&nbsp;&nbsp;4</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p> <p id="ar84" style="margin: 0px;"><span id="kyq5" style="color: rgb(43, 145, 175);">&nbsp;&nbsp;&nbsp;&nbsp;5</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; container.RegisterType&lt;<span id="ooxw" style="color: rgb(43, 145, 175);">ILoggingService</span>,</p> <p id="xxhe" style="margin: 0px;"><span id="al7e" style="color: rgb(43, 145, 175);">&nbsp;&nbsp;&nbsp;&nbsp;6</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span id="t98d" style="color: rgb(43, 145, 175);">ConsoleLoggingService</span>&gt;(<span id="d::a" style="color: blue;">new</span> <span id="h1m." style="color: rgb(43, 145, 175);">ContainerControlledLifetimeManager</span>());</p> <p id="huku" style="margin: 0px;"><span id="vmso" style="color: rgb(43, 145, 175);">&nbsp;&nbsp;&nbsp;&nbsp;7</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span id="ul:s" style="color: rgb(43, 145, 175);">MainApplicationModule</span> mainModule = container.Resolve&lt;<span id="xbvk" style="color: rgb(43, 145, 175);">MainApplicationModule</span>&gt;();</p> <p id="u4.t" style="margin: 0px;"><span id="h9jh" style="color: rgb(43, 145, 175);">&nbsp;&nbsp;&nbsp;&nbsp;8</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span id="a.xi" style="color: rgb(43, 145, 175);">Console</span>.ReadLine();</p> <p id="cs8z" style="margin: 0px;"><span id="g5wy" style="color: rgb(43, 145, 175);">&nbsp;&nbsp;&nbsp;&nbsp;9</span>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p> <p id="l06z" style="margin: 0px;"><span id="k7ku" style="color: rgb(43, 145, 175);">&nbsp;&nbsp;&nbsp;10</span>&nbsp;&nbsp;&nbsp;&nbsp; }</p></div><p>&nbsp;En la linea 7 del anterior fragmento de c&oacute;digo, solicitamos al contenedor que nos devuelva un objeto del tipo <font color="#3d85c6" id="x25h">MainApplicationModule</font>. Obs&eacute;rvese que en este caso no ha sido necesario registrar el objeto con el contenedor previamente. La utilidad de crear un objeto a trav&eacute;s del contenedor de un tipo que no ha sido previamente registrado es que el contenedor evaluar&aacute; e inyectar&aacute; las dependencias de dicho objeto al generarle.</p><p>Despu&eacute;s de la ejecuci&oacute;n de la linea 7 aparecer&aacute; en la consola del sistema la siguiente l&iacute;nea indicando que se ha realizado el proceso de inyecci&oacute;n de la dependencia <font color="#3d85c6" id="z:e_">ILoggingService</font> correctamente:</p><p><font color="#ffffff" id="h30."><span id="l6bp" style="background-color: rgb(0, 0, 0);">Console: Inicializado el m&oacute;dulo principal de la aplicaci&oacute;n</span></font></p><p>Las ventajas de la utilizacion del patron de dise&ntilde;o de inyecci&oacute;n de dependencias se hacen evidentes a m&eacute;dida que el n&uacute;mero de componentes de la aplicaci&oacute;n aumenta, permitiendonos mantener un acoplamiento d&eacute;bil entre dichos componentes y facilitando el mantenimiento posterior de la aplicaci&oacute;n al unificar el sistema de construcci&oacute;n y cableado de objetos.</p><p>Puede que surja la pregunta de que tipo de objetos debemos instanciar a trav&eacute;s del contenedor. En mi experiencia, los componentes que forman parte de la arquitectura o flujo principal de la aplicaci&oacute;n, esto es, servicios, vistas, presentadores, m&oacute;delos, etc, son buenos candidatos para ser incluidos en el contenedor.</p><p>Finalizaremos este art&iacute;culo enumerando dos ventajas instantaneas de utilizar un contenedor para estructurar nuestra aplicaci&oacute;n:</p><ol id="e00v"><li id="fh8c">Si en lugar de mostrar los eventos del sistema por la consola decidimos registrarles en una base de datos, podr&iacute;amos definir un nuevo tipo <font color="#3d85c6" id="s0_.">DatabaseLoggingService</font> implementando el interface <font color="#3d85c6" id="krxh">ILoggingService</font> y registrar dicho tipo en lugar de <font color="#3d85c6" id="pgad">ConsoleLoggingService</font>. Con esa sencilla modificaci&oacute;n la aplicaci&oacute;n pasar&iacute;a a registrar los eventos en una base de datos.</li><li id="fh8c">El contenedor introduce el concepto de 'cadena de montaje' y nos permite extender las acciones a realizar a la hora de crear un objeto. Un uso t&iacute;pico es el 'EventBroker' o sistema de gesti&oacute;n de eventos que permite marcar eventos de los tipos con el atributo de publicaci&oacute;n y m&eacute;todos con el atributo de suscripci&oacute;n, encargandose el contenedor a la hora de construir los objetos de cablear los publicadores con los suscriptores facilitando la implementaci&oacute;n del patron de dise&ntilde;o <a title="observador" target="_blank" href="http://es.wikipedia.org/wiki/Observer_%28patr%C3%B3n_de_dise%C3%B1o%29" id="i_hu">observador</a>.</li></ol><p>&nbsp;</p>